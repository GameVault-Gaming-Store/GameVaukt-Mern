<!-- userDashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>User Dashboard | Online Gaming Shop</title>

  <link rel="stylesheet" href="dashboard.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body>

  <!-- ================= SIDEBAR ================= -->
  <aside class="sidebar">
    <h2 class="logo">ğŸ® GameStore</h2>

    <!-- TOP MENU -->
    <ul class="menu menu-top">
      <li class="active" onclick="showSection('dashboard',this)">
        <i class="fa-solid fa-house"></i> Dashboard
      </li>
      <li onclick="showSection('store',this)">
        <i class="fa-solid fa-store"></i> Game Store
      </li>

      <!-- âœ… UPDATED: Deals now opens embedded section -->
      <li onclick="showSection('discounts',this)">
        <i class="fa-solid fa-tags"></i> Deals
      </li>

      <li onclick="showSection('wishlist',this)">
        <i class="fa-solid fa-heart"></i> Wishlist
      </li>
      <li onclick="showSection('community',this)">
        <i class="fa-solid fa-comments"></i> Community
      </li>
      <li onclick="showSection('profile',this)">
        <i class="fa-solid fa-user"></i> Profile
      </li>
    </ul>

    <!-- BOTTOM MENU -->
    <ul class="menu menu-bottom">
      <li class="logout" onclick="logout()">
        <i class="fa-solid fa-right-from-bracket"></i> Logout
      </li>
    </ul>
  </aside>

  <!-- ================= MAIN CONTENT ================= -->
  <main class="main-content">

    <!-- ===== DASHBOARD SECTION ===== -->
    <section id="dashboard" class="content-section active">
      <h1 class="welcome-text">Welcome, Gamer ğŸ‘¾</h1>

      <div class="cards">
        <div class="card clickable" id="gamesOwnedCard" title="Click to view your games">
          ğŸ® Games Owned<br><strong id="gamesOwnedCount">12</strong>
          <div class="tiny-hint">Click to view</div>
        </div>

        <div class="card">
          â­ Gamer Level<br><strong>Explorer</strong>
        </div>
      </div>

      <div class="mood-box">
        <h2>ğŸ§  How are you feeling today?</h2>
        <select id="moodSelect">
          <option value="">Select your mood</option>
          <option value="relaxed">ğŸ˜Œ Relaxed</option>
          <option value="excited">ğŸ”¥ Excited</option>
          <option value="competitive">âš”ï¸ Competitive</option>
          <option value="sad">ğŸ˜¢ Sad</option>
        </select>
        <button onclick="suggestGame()">Suggest Game</button>
        <div id="moodResult" class="mood-result"></div>
      </div>
    </section>

    <!-- ===== GAME STORE SECTION (INSIDE DASHBOARD) ===== -->
    <section id="store" class="content-section">
      <div class="store-shell" id="storeEmbedded">

        <div class="store-header-mini">
          <div>
            <h1 class="store-title">ğŸ® Game Store</h1>
            <p class="store-subtitle">Browse, filter, compare, and wishlist games.</p>
          </div>
        </div>

        <section class="filters-card">
          <div class="field">
            <label for="searchInput">Search</label>
            <div class="input-wrap">
              <span class="icon">ğŸ”</span>
              <input id="searchInput" type="text" placeholder="Search games by name..." onkeyup="searchGames()" />
            </div>
          </div>

          <div class="field">
            <label for="genreFilter">Genre</label>
            <select id="genreFilter" onchange="filterGames()">
              <option value="All">All Genres</option>
              <option value="Action">Action</option>
              <option value="RPG">RPG</option>
              <option value="Strategy">Strategy</option>
            </select>
          </div>

          <div class="field">
            <label for="playtimeFilter">Playtime</label>
            <select id="playtimeFilter" onchange="filterGames()">
              <option value="All">All Playtime</option>
              <option value="Short">Short</option>
              <option value="Medium">Medium</option>
              <option value="Long">Long</option>
            </select>
          </div>

          <div class="field">
            <label for="priceFilter">Max Price</label>
            <select id="priceFilter" onchange="filterGames()">
              <option value="All">Any Price</option>
              <option value="20">Under $20</option>
              <option value="50">Under $50</option>
            </select>
          </div>

          <div class="field">
            <label for="discountFilter">Discount</label>
            <select id="discountFilter" onchange="filterGames()">
              <option value="All">Any Discount</option>
              <option value="10">10%+ Off</option>
              <option value="20">20%+ Off</option>
              <option value="30">30%+ Off</option>
              <option value="50">50%+ Off</option>
            </select>
          </div>

          <div class="field actions">
            <label>Actions</label>
            <div class="btn-row">
              <button class="ghost-btn" type="button" onclick="resetFilters()">Reset</button>
              <button class="primary-btn" type="button" onclick="openCompareIfReady()">Compare Selected (2)</button>
            </div>
          </div>
        </section>

        <section class="info-strip">
          <div class="chip">âœ… Search + Filters</div>
          <div class="chip">âš”ï¸ Select 2 games to compare</div>
          <div class="chip">ğŸ•’ Playtime warning in details</div>
          <div class="chip">ğŸ·ï¸ â€œWho is this game for?â€ tags</div>
        </section>

        <section id="gameGrid" class="game-grid"></section>

        <div id="compareBar" class="compare-bar hidden">
          <div class="compare-left">
            <span class="compare-title">âš”ï¸ Compare</span>
            <span class="compare-count" id="compareCountText">0/2 selected</span>
            <span class="compare-items" id="compareItemsText"></span>
          </div>
          <div class="compare-right">
            <button class="ghost-btn" onclick="clearCompare()">Clear</button>
            <button class="primary-btn" onclick="openCompareIfReady()">Compare Now</button>
          </div>
        </div>

      </div>
    </section>

    <!-- ===== âœ… DEALS (DISCOUNTS) SECTION - FULL UI EMBEDDED ===== -->
    <section id="discounts" class="content-section">

      <header class="discount-header">
        <div class="header-left">
          <h1>ğŸ’¸ Discounts & Deals</h1>
          <p class="subtitle">Only games with active discounts appear here.</p>
        </div>
      </header>

      <section class="settings-card">
        <div class="settings-top">
          <div>
            <h2>ğŸ”” Price Drop Alerts</h2>
            <p class="muted">Watch games to get notified on your dashboard when price drops (backend later).</p>
          </div>

          <label class="switch">
            <input id="alertsEnabled" type="checkbox" />
            <span class="slider"></span>
          </label>
        </div>

        <div class="settings-row">
          <div class="field">
            <label for="thresholdSelect">Alert when price drops by</label>
            <select id="thresholdSelect">
              <option value="5">5%+</option>
              <option value="10" selected>10%+</option>
              <option value="15">15%+</option>
              <option value="20">20%+</option>
              <option value="30">30%+</option>
            </select>
          </div>

          <div class="field">
            <label>&nbsp;</label>
            <div class="btn-row">
              <button class="ghost-btn" type="button" onclick="saveAlertSettings()">Save</button>
              <button class="danger-btn" type="button" onclick="clearAllWatched()">Clear Watched</button>
            </div>
          </div>
        </div>

        <div id="settingsMsg" class="msg"></div>
      </section>

      <section class="section-head">
        <h2>ğŸ”¥ Discounted Games</h2>
        <div class="mini-info">
          <span id="dealCount" class="pill">0 deals</span>
          <span id="watchCount" class="pill">0 watched</span>
        </div>
      </section>

      <section id="discountGrid" class="discount-grid"></section>

    </section>

    <!-- ===== WISHLIST SECTION ===== -->
    <section id="wishlist" class="content-section">
      <h1>Wishlist</h1>
      <p>No games saved yet.</p>
    </section>

    <!-- ===== COMMUNITY SECTION (UPDATED: EMBED COMMUNITY REVIEWS UI) ===== -->
    <section id="community" class="content-section">
      <div class="wrap">

        <header class="head">
          <div>
            <h1>â­ Reviews & Ratings</h1>
            <p class="sub">Review games you own, react, and mark helpful reviews.</p>
          </div>

          <div class="stats">
            <div class="stat">
              <div class="stat-label">Total Reviews</div>
              <div class="stat-value" id="totalReviewsStat">0</div>
            </div>
            <div class="stat">
              <div class="stat-label">Avg Rating</div>
              <div class="stat-value" id="avgRatingStat">â€”</div>
            </div>
          </div>
        </header>

        <!-- TOP REVIEW -->
        <section class="card top" id="topReviewCard"></section>

        <!-- WRITE / EDIT REVIEW -->
        <section class="card compose">
          <div class="compose-head">
            <h2 id="formTitle">âœï¸ Write a Review</h2>
            <span class="tiny">Only purchased games are available</span>
          </div>

          <div class="grid">
            <div class="field">
              <label>Game</label>
              <select id="reviewGameSelect"></select>
            </div>

            <div class="field">
              <label>Rating</label>
              <div class="star-input" id="starInput">
                <button type="button" data-star="1">â˜…</button>
                <button type="button" data-star="2">â˜…</button>
                <button type="button" data-star="3">â˜…</button>
                <button type="button" data-star="4">â˜…</button>
                <button type="button" data-star="5">â˜…</button>
                <span class="star-hint" id="starHint">Select stars</span>
              </div>
              <input type="hidden" id="reviewRating" value="0" />
            </div>

            <div class="field full">
              <label>Your Review</label>
              <textarea id="reviewText" maxlength="400" placeholder="Be honest. What did you like or dislike?"></textarea>

              <div class="compose-footer">
                <span class="char" id="charCount">0/400</span>
                <div class="btn-row">
                  <button class="btn primary" type="button" id="submitBtn" onclick="submitReview()">Post Review</button>
                  <button class="btn ghost" type="button" id="cancelEditBtn" style="display:none;" onclick="cancelEdit()">Cancel Edit</button>
                </div>
              </div>

              <div class="msg" id="reviewMsg"></div>
            </div>
          </div>
        </section>

        <!-- FEED CONTROLS -->
        <section class="feed-head">
          <h2>ğŸ—£ï¸ Community Reviews</h2>

          <div class="controls">
            <input id="reviewSearch" type="text" placeholder="Search reviews..." />
            <select id="reviewFilterGame"></select>
            <select id="reviewSort">
              <option value="top" selected>Top</option>
              <option value="new">Newest</option>
              <option value="high">Highest Rating</option>
              <option value="low">Lowest Rating</option>
            </select>
          </div>
        </section>

        <!-- REVIEWS LIST -->
        <section id="reviewsList" class="reviews"></section>

      </div>
    </section>

    <!-- ===== PROFILE SECTION ===== -->
    <section id="profile" class="content-section">
      <h1>User Profile</h1>
      <input type="text" value="Username" />
      <input type="email" value="user@email.com" />
      <button>Update Profile</button>

      <h3>Purchase History</h3>
      <ul>
        <li>Cyber Quest â€“ $29.99</li>
        <li>Shadow Arena â€“ $49.99</li>
      </ul>

      <button onclick="goToPage('purchases/purchases.html')">
        View Full Purchase History
      </button>
    </section>

  </main>

  <!-- ================= RIGHT NOTIFICATION SECTION (TOP 50%) ================= -->
  <aside class="notification-panel">
    <div class="panel-header">
      <h4>ğŸ”” Notifications</h4>
      <span class="panel-badge" id="notifCount">0</span>
    </div>
    <ul id="notifItems" class="panel-list"></ul>
  </aside>

  <!-- ================= RIGHT GAME ASSISTANT (BOTTOM 50%) ================= -->
  <aside class="assistant-panel">
    <div class="panel-header">
      <h4>ğŸ¤– Game Assistant</h4>
      <button class="panel-action" onclick="clearChat()">Clear</button>
    </div>

    <div id="chatArea" class="chat-area">
      <div class="bot">ğŸ‘‹ Hi! Ask me anything about games, deals, tips, or navigation.</div>
      <div class="bot small">Try: <b>help</b>, <b>recommend action</b>, <b>best deals</b>, <b>go store</b>, <b>mood</b></div>
    </div>

    <div class="chat-input-row">
      <input type="text" id="chatInput" placeholder="Ask something..."
             onkeydown="if(event.key==='Enter')sendMessage()"/>
      <button onclick="sendMessage()">Send</button>
    </div>
  </aside>

  <!-- ================= OWNED GAMES MODAL ================= -->
  <div id="ownedGamesModal" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ® My Games</h3>
        <button class="modal-close" onclick="closeOwnedGames()" aria-label="Close">âœ•</button>
      </div>

      <div class="modal-sub">
        <input id="ownedSearch" class="modal-search" type="text" placeholder="Search your games..."
               oninput="renderOwnedGames(this.value)" />
        <span class="modal-count" id="ownedModalCount">0</span>
      </div>

      <div id="ownedGamesGrid" class="owned-grid"></div>
    </div>
  </div>

  <!-- âœ… Store Details Modal -->
  <div id="storeDetailsModal" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <h3 id="title">Game Details</h3>
        <button class="modal-close" onclick="closeStoreDetails()" aria-label="Close">âœ•</button>
      </div>

      <div style="padding:16px;">
        <p><b>Price:</b> <span id="price"></span> <span id="originalPrice" style="opacity:.7;margin-left:8px;"></span></p>
        <p><b>Discount:</b> <span id="discount"></span></p>
        <p><b>Rating:</b> â­ <span id="rating"></span></p>
        <p><b>Playtime:</b> <span id="playtime"></span></p>
        <p id="playtimeWarning" style="margin-top:10px; color:#ffeb3b;"></p>

        <h4 style="margin-top:16px; color:#00e5ff;">Who is this game for?</h4>
        <div id="tags" class="tags"></div>

        <!-- âœ… NEW: Buy + Cart buttons -->
        <div id="storeDetailsFooter" style="display:flex;gap:10px;margin-top:16px;flex-wrap:wrap;">
          <button class="primary-btn" type="button" id="buyNowBtn">ğŸ’³ Buy Now</button>
          <button class="ghost-btn" type="button" id="addToCartBtn">ğŸ›’ Add to Cart</button>
          <button class="ghost-btn" type="button" onclick="openCart()">View Cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Compare Modal -->
  <div id="storeCompareModal" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <h3>âš”ï¸ Compare Games</h3>
        <button class="modal-close" onclick="closeStoreCompare()" aria-label="Close">âœ•</button>
      </div>

      <div style="padding:16px;">
        <div id="compareGrid" class="compare"></div>
      </div>
    </div>
  </div>

  <!-- âœ… Cart Modal (NEW) -->
  <div id="cartModal" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ›’ My Cart</h3>
        <button class="modal-close" onclick="closeCart()" aria-label="Close">âœ•</button>
      </div>

      <div style="padding:16px;">
        <div id="cartItems"></div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:14px;">
          <b>Total:</b>
          <span id="cartTotal">$0.00</span>
        </div>

        <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap;">
          <button class="ghost-btn" onclick="clearCart()" type="button">Clear Cart</button>
          <button class="primary-btn" onclick="checkoutCart()" type="button">Checkout</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main JS (ONLY ONE FILE NEEDED) -->
  <script src="dashbaord.js"></script>
</body>
</html>
